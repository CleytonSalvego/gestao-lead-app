<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <div class="header-content">
      <div class="header-title">
        <ion-title>Redes Sociais</ion-title>
        <p class="header-subtitle">Gerencie seu conteúdo e campanhas</p>
      </div>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="refreshData()" fill="clear" class="refresh-btn">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Empty State: No Integrations -->
  <div class="empty-state-container" *ngIf="availableIntegrations.length === 0 && !isLoading">
    <app-coming-soon
      title="Integrações"
      subtitle="Gerencie suas informações"
      description="Configure integrações com redes sociais para visualizar e gerenciar posts, reels e campanhas. Conecte-se com Facebook, Instagram e outras plataformas."
      icon="link-outline"
      iconColor="primary"
      [showButton]="true"
      buttonText="Criar Integração"
      buttonColor="primary"
      buttonFill="solid"
      (buttonClick)="createIntegration()">
    </app-coming-soon>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-content">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Carregando integrações...</p>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div class="dashboard-container" *ngIf="availablePages.length > 0 && !isLoading">

    <!-- Pages Selection Section -->
    <div class="dashboard-section pages-section">
      <div class="section-header">
        <div class="header-content">
          <h2>Páginas Conectadas</h2>
          <p>Gerencie o conteúdo das suas páginas</p>
        </div>
        <div class="section-actions">
          <ion-button
            (click)="loadPagesForIntegration()"
            fill="clear"
            size="small"
            class="refresh-pages-btn">
            <ion-icon name="refresh" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Loading Pages -->
      <div class="loading-state pages-loading" *ngIf="isLoadingPages">
        <ion-skeleton-text animated style="width: 100%; height: 120px; border-radius: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 120px; border-radius: 12px;"></ion-skeleton-text>
      </div>

      <!-- Pages Grid -->
      <div class="pages-grid" *ngIf="!isLoadingPages && availablePages.length > 0">
        <div
          *ngFor="let page of availablePages; trackBy: trackByPageId"
          class="page-card modern-card"
          [class.active]="selectedPage?.id === page.id"
          (click)="selectPage(page)">

          <div class="card-header">
            <div class="page-avatar">
              <img [src]="page.profilePicture" [alt]="page.pageName" loading="lazy">
              <div class="verified-badge" *ngIf="page.isVerified">
                <ion-icon name="checkmark-circle"></ion-icon>
              </div>
            </div>
            <div class="platform-badge">
              <ion-icon [name]="getPlatformIcon(page.platform)"></ion-icon>
            </div>
          </div>

          <div class="card-content">
            <h3 class="page-name">{{ page.pageName }}</h3>
            <p class="page-username">{{ page.username }}</p>

            <div class="page-metrics">
              <div class="metric-item">
                <span class="metric-value">{{ formatNumber(page.followers || 0) }}</span>
                <span class="metric-label">Seguidores</span>
              </div>
              <div class="metric-item">
                <span class="metric-value">{{ page.posts || 0 }}</span>
                <span class="metric-label">Posts</span>
              </div>
            </div>
          </div>

          <div class="card-footer" *ngIf="selectedPage?.id === page.id">
            <div class="selected-indicator">
              <ion-icon name="checkmark-circle"></ion-icon>
              <span>Selecionada</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty Pages State -->
      <div class="empty-pages-state" *ngIf="!isLoadingPages && availablePages.length === 0">
        <div class="empty-content">
          <ion-icon name="albums-outline"></ion-icon>
          <h3>Nenhuma página encontrada</h3>
          <p>Conecte suas páginas do Facebook e Instagram para começar</p>
          <ion-button (click)="loadPagesForIntegration()" fill="outline" color="primary">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Sincronizar Páginas
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Content Management Section -->
    <div class="dashboard-section content-section" *ngIf="selectedPage">
      <div class="section-header">
        <div class="header-content">
          <h2>{{ selectedPage.pageName }}</h2>
          <p>Gerencie posts, reels e campanhas</p>
        </div>
      </div>

      <!-- Analytics Overview -->
      <div class="analytics-cards">
        <div class="analytics-card">
          <div class="card-icon posts">
            <ion-icon name="grid-outline"></ion-icon>
          </div>
          <div class="card-data">
            <span class="data-number">{{ getTotalPosts() }}</span>
            <span class="data-label">Posts</span>
          </div>
        </div>

        <div class="analytics-card">
          <div class="card-icon reels">
            <ion-icon name="play-outline"></ion-icon>
          </div>
          <div class="card-data">
            <span class="data-number">{{ getTotalReels() }}</span>
            <span class="data-label">Reels</span>
          </div>
        </div>

        <div class="analytics-card">
          <div class="card-icon campaigns">
            <ion-icon name="megaphone-outline"></ion-icon>
          </div>
          <div class="card-data">
            <span class="data-number">{{ getTotalCampaigns() }}</span>
            <span class="data-label">Campanhas</span>
          </div>
        </div>

        <div class="analytics-card">
          <div class="card-icon reach">
            <ion-icon name="eye-outline"></ion-icon>
          </div>
          <div class="card-data">
            <span class="data-number">{{ formatNumber(getTotalReach()) }}</span>
            <span class="data-label">Alcance</span>
          </div>
        </div>
      </div>

      <!-- Content Navigation -->
      <div class="content-tabs">
        <div class="tabs-container">
          <button
            class="tab-button"
            [class.active]="contentType === 'posts'"
            (click)="contentType = 'posts'; loadContentForPage()">
            <ion-icon name="grid-outline"></ion-icon>
            <span>Posts</span>
            <div class="tab-badge" *ngIf="getTotalPosts() > 0">{{ getTotalPosts() }}</div>
          </button>
          <button
            class="tab-button"
            [class.active]="contentType === 'campaigns'"
            (click)="contentType = 'campaigns'; loadContentForPage()">
            <ion-icon name="megaphone-outline"></ion-icon>
            <span>Campanhas</span>
            <div class="tab-badge" *ngIf="getTotalCampaigns() > 0">{{ getTotalCampaigns() }}</div>
          </button>
        </div>
      </div>

      <!-- Posts Content -->
      <div class="content-area" *ngIf="contentType === 'posts'">
        <div class="posts-grid" *ngIf="filteredPosts.length > 0">
          <div
            *ngFor="let post of filteredPosts; trackBy: trackByPostId"
            class="post-card modern-post-card"
            [attr.data-post-type]="post.type">

            <div class="post-media">
              <img [src]="getPostMediaUrl(post)" [alt]="getPostCaption(post)" loading="lazy">
              <div class="post-type-overlay">
                <div class="type-badge">
                  <ion-icon [name]="getPostTypeIcon(post.type)"></ion-icon>
                  <span>{{ getPostTypeLabel(post.type) }}</span>
                </div>
              </div>
            </div>

            <div class="post-body">
              <div class="post-text">
                <p>{{ getPostCaption(post) | slice:0:120 }}{{ getPostCaption(post).length > 120 ? '...' : '' }}</p>
              </div>

              <div class="post-engagement">
                <div class="engagement-item likes">
                  <ion-icon name="heart"></ion-icon>
                  <span>{{ formatNumber(post.metrics.likes) }}</span>
                </div>
                <div class="engagement-item comments">
                  <ion-icon name="chatbubble"></ion-icon>
                  <span>{{ formatNumber(post.metrics.comments) }}</span>
                </div>
                <div class="engagement-item shares">
                  <ion-icon name="share-social"></ion-icon>
                  <span>{{ formatNumber(post.metrics.shares) }}</span>
                </div>
              </div>

              <div class="post-meta">
                <span class="post-date">{{ post.publishedAt | date:'dd/MM' }}</span>
                <div class="platform-badge">
                  <ion-icon [name]="getPlatformIcon(post.platform)"></ion-icon>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty Posts State -->
        <div class="empty-content-state" *ngIf="filteredPosts.length === 0">
          <div class="empty-illustration">
            <ion-icon name="images-outline"></ion-icon>
          </div>
          <h3>Nenhum post encontrado</h3>
          <p>Começe criando conteúdo incrível para sua audiência</p>
        </div>
      </div>

      <!-- Campaigns Content -->
      <div class="content-area" *ngIf="contentType === 'campaigns'">
        <div class="campaigns-grid" *ngIf="campaigns.length > 0">
          <div
            *ngFor="let campaign of campaigns"
            class="campaign-card modern-campaign-card">

            <div class="campaign-header">
              <div class="campaign-icon">
                <ion-icon name="megaphone"></ion-icon>
              </div>
              <div class="campaign-status" [attr.data-status]="campaign.status">
                <div class="status-dot"></div>
                <span>{{ getStatusName(campaign.status) }}</span>
              </div>
            </div>

            <div class="campaign-body">
              <h3 class="campaign-title">{{ campaign.name }}</h3>
              <p class="campaign-objective">{{ getCampaignObjective(campaign) }}</p>

              <div class="campaign-metrics-grid">
                <div class="metric-card">
                  <ion-icon name="eye-outline"></ion-icon>
                  <div class="metric-data">
                    <span class="metric-value">{{ formatNumber(campaign.metrics.reach) }}</span>
                    <span class="metric-label">Alcance</span>
                  </div>
                </div>
                <div class="metric-card">
                  <ion-icon name="bar-chart-outline"></ion-icon>
                  <div class="metric-data">
                    <span class="metric-value">{{ formatNumber(campaign.metrics.impressions) }}</span>
                    <span class="metric-label">Impressões</span>
                  </div>
                </div>
                <div class="metric-card">
                  <ion-icon name="finger-print-outline"></ion-icon>
                  <div class="metric-data">
                    <span class="metric-value">{{ formatNumber(campaign.metrics.clicks) }}</span>
                    <span class="metric-label">Cliques</span>
                  </div>
                </div>
                <div class="metric-card budget">
                  <ion-icon name="card-outline"></ion-icon>
                  <div class="metric-data">
                    <span class="metric-value">R$ {{ formatNumber(campaign.budget.spent) }}</span>
                    <span class="metric-label">Investido</span>
                  </div>
                </div>
              </div>

              <div class="campaign-footer">
                <div class="campaign-period">
                  <ion-icon name="calendar-outline"></ion-icon>
                  <span>{{ campaign.startDate | date:'dd/MM' }} - {{ (campaign.endDate || campaign.startDate) | date:'dd/MM' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty Campaigns State -->
        <div class="empty-content-state" *ngIf="campaigns.length === 0">
          <div class="empty-illustration">
            <ion-icon name="megaphone-outline"></ion-icon>
          </div>
          <h3>Nenhuma campanha ativa</h3>
          <p>Crie campanhas para promover seu conteúdo e alcançar mais pessoas</p>
        </div>
      </div>
    </div>

  </div>
</ion-content>
